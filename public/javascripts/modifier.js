// Generated by CoffeeScript 1.6.3
var verifierAjax;

($(document)).ready(function() {
  ajouteElement(verifierAjax, {
    id_fieldset: '#antecedents',
    id_click: '#antecedent',
    date: 'date_antecedent',
    'date_msg_req': 'Vous devez entrer une date d\'antécédent.',
    'date_msg_pattern': 'Format de date illégal.',
    description: 'description_antecedent',
    'description_msg_req': 'Vous devez entrer une description d\'antécédent.',
    'bouton_msg': 'Enlever cet antécédent'
  });
  ajouteElement(verifierAjax, {
    id_fieldset: '#suivis',
    id_click: '#suivi',
    date: 'date_suivi',
    'date_msg_req': 'Vous devez entrer une date de suivi.',
    'date_msg_pattern': 'Format de date illégal.',
    description: 'description_suivi',
    'description_msg_req': 'Vous devez entrer une description de suivi.',
    'bouton_msg': 'Enlever ce suivi'
  });
  ajouteElement(verifierAjax, {
    id_fieldset: '#notes',
    id_click: '#note',
    date: 'date_note',
    'date_msg_req': 'Vous devez entrer une date de note',
    'date_msg_pattern': 'Format de date illégal.',
    description: 'description_note',
    'description_msg_req': 'Vous devez entrer une description de note.',
    'bouton_msg': 'Enlever cette note'
  });
  return ajouteElement(verifierAjax, {
    id_fieldset: '#visites',
    id_click: '#visite',
    date: 'date_visite',
    'date_msg_req': 'Vous devez entrer une date de visite.',
    'date_msg_pattern': 'Format de date illégal.',
    description: 'description_visite',
    'description_msg_req': 'Vous devez entrer une description de visite.',
    'bouton_msg': 'Enlever cette visite'
  });
});

($(document)).ready(function() {
  return ($('.remove')).click(function() {
    ($(this)).parent().parent().parent().remove();
    return verifierAjax();
  });
});

($(document)).ready(function() {
  return ($('input, textarea, select')).change(function() {
    return verifierAjax();
  });
});

($(document)).ready(function() {
  var form;
  return form = ($('.myform')).validate({
    invalidHandler: function(event, validator) {
      return afficherErreur();
    },
    submitHandler: function() {
      return false;
    }
  });
});

verifierAjax = function() {
  var donnees, isValid;
  isValid = ($(".myform")).valid();
  if (isValid) {
    donnees = ($(".myform")).serialize();
    return $.ajax({
      type: "POST",
      url: "/modifierDossier",
      data: donnees,
      dataType: 'json',
      success: function(data) {
        var alert;
        alert = $('<div>', {
          "class": 'alert alert-success',
          text: data.message
        });
        alert.append($('<a>', {
          href: '#',
          "class": 'close',
          'data-dismiss': 'alert',
          text: 'x'
        }));
        ($("#alert_placeholder")).empty().append(alert);
        return alert.fadeTo(5000, 0);
      },
      error: function(request, status, error) {
        return afficherErreur(status);
      }
    });
  }
};
